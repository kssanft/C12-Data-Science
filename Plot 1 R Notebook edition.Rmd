---
title: "R Notebook"
output: html_notebook
---

This is just a rough overview of plot 1 in R Notebook form. Firstly, we need to install our various packages as well as load any libraries needed 

```{r}
install.packages("tidyverse")
install.packages("ggthemes")
library(tidyverse)
library(ggplot2)
library(dplyr)
library(ggthemes)
```

Now, we can begin by downloading our CSV dataset files and having a quick look at that data that we have been provided

```{r}
gdp_per_capita <- read.csv("gdp-per-capita-worldbank.csv")
continents <- read.csv("continents-according-to-our-world-in-data.csv")

#View(gdp_per_capita)
#View(continents)
```

After loading the data, we created a new dataframe called "gdp_per_capita2" that includes a new column indicating each country's annual GDP growth rate. We calculated this value as the percentage change from the previous year's GDP using the mutate() and lag() functions. From this, we were able to combine the two data sets together using left join and matching up the data with the same country code. Additionally, because the lag() function produces an NA for the first year of each country (since there is no previous value to compare to), we removed these missing values before continuing our analysis.

With this newly combined data set, we then created a summary dataframe called "continent_growth", where we grouped the data by Continent and Year, and finally determined the average GDP growth per continent per year, removing any missing values.

```{r}

gdp_per_capita2 <- gdp_per_capita %>%
  rename(GDP = GDP.per.capita..PPP..constant.2017.international... ) %>%
  group_by(Code) %>%
  mutate(GDP_growth_rate = (GDP - lag(GDP)) / lag(GDP) * 100) %>%
  ungroup ()%>%
  select(Code,Entity, Year, GDP_growth_rate) %>%
  left_join (continents %>% select (Code, Continent), by = "Code") %>%
  drop_na()

continent_growth <- gdp_per_capita2 %>%
  group_by(Continent, Year) %>%
  summarise (avg_GDP_growth = mean(GDP_growth_rate, na.rm = TRUE)) 

View(continent_growth)
```

Using this cleaned up dataset, we plotted how the average GDP per capita growth rate has changed over time for each continent, connecting the scatter plot data to see the overall trends. Additionally, we customized the plot by adding a title, axis labels, as well as applying a manual color scale so that every country has it's own distinct color associated with it. The resulting figure clearly illustrates how GDP growth has varied across continents over time, which helps us identify differences in economic performance.

```{r}
ggplot(continent_growth, aes(x = Year, y = avg_GDP_growth, color = Continent)) +
  geom_line(linewidth = 1.25) +
  labs(
    title = "Average GDP per Capita Growth Rate by Continent Over Time",
    x = "Year",
    y = "Average GDP per Capita Growth Rate (%)"
  ) +
  scale_colour_manual(values = c("Africa" = "#F5A623", 
                                 "Asia" = "#b90a07",
                                 "Europe" ="#008F39" ,
                                 "North America" ="#015294",
                                 "Oceania" = "#7B1FA2",
                                 "South America" = "#E91E63"
                                 )) +
  theme_economist_white() +
  theme(
    text = element_text(size = 11),
    legend.title = element_text(size = 11),
    legend.text = element_text(size = 10)
  )
```

From this graph, we can see a few clear downturns in the Average GDP per capita growth rate, particularly right before 2010, and during 2020. These points clearly align with the global crisises happening at the time, with the 2008 Market crash (affecting Europe and North America the most notably), as well as the COVID-19 pandemic which affected every continent in 2020.


Now we will plot the average GDP growth rate over time as a heat map, using Plotly. ##ADD MORE EXPLANATION##
```{r}


country_growth <- gdp_per_capita2 %>%
  drop_na(GDP_growth_rate)       

#View(country_growth)

country_growth$hover <- with(country_growth,paste( 
         "<br> Country: ",Entity, "<br>",
         "Continent: ", Continent, "<br>",
         "GDP Growth: ", round(GDP_growth_rate, 2), "%" ))

g <- list(
  showframe = FALSE,
  showcoastlines = FALSE,
  projection = list(type = 'Mercator')
)


p <- plot_geo(country_growth, locationmode = "world") %>%
  add_trace(
    text = ~ hover,
    hoverinfo = "text",
    locations =  ~ Code,           
    z =  ~ GDP_growth_rate,    
    frame =  ~ Year,           
    color =  ~ GDP_growth_rate,     
    colors = "PuOr",        
    marker = list(line = list(colour = toRGB ("grey"), width = 0.5))
  ) %>%
  colorbar(title = "GDP Growth (%)") %>%
  layout( title = "Annual GDP per Capita Growth by Country",
          geo = g)
p


```
